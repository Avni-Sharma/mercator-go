import json
import sys
import yaml
from pprint import pprint

def process_file(fpath):
    with open(fpath, 'r') as stream:
        try:
            content = yaml.load(stream)
        except yaml.YAMLError as exc:
            print(exc)

    if 'updated' in content:
        content['updated'] = content['updated'].isoformat()

    return content


if __name__ == '__main__':
  content = {}

  for i in range(1, len(sys.argv)):
    if sys.argv[i].endswith('glide.yaml'):
      content.update(process_file(sys.argv[i]))
    elif sys.argv[i].endswith('glide.lock'):
      content['_dependency_tree_lock_file'] = process_file(sys.argv[i])

  print(json.dumps(content))
